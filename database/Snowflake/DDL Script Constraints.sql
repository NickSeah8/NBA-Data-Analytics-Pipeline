---------------------   THIS SCRIPT IS USED TO CREATE THE SCHEMA AND KEYS FOR PROCESSED NBA DATA TABLES IN SNOWFLAKE   ---------------------
-- Create the schema for loading processed data tables into
CREATE SCHEMA IF NOT EXISTS NBA_PROCESSED_2024_25;

-- Adding keys for player data tables
ALTER TABLE NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25
ADD CONSTRAINT PK_PLAYERS PRIMARY KEY (PERSON_ID);

-- Adding keys for team data tables
ALTER TABLE NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25
ADD CONSTRAINT PK_TEAMS PRIMARY KEY (TEAM_ID);

-- Adding keys for advanced data tables
ALTER TABLE NBA_PROCESSED_2024_25.ADVANCED_PROCESSED_2024_25
ADD CONSTRAINT PK_ADVANCED PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.ADVANCED_PROCESSED_2024_25
ADD CONSTRAINT FK_ADV_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.ADVANCED_PROCESSED_2024_25
ADD CONSTRAINT FK_ADV_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for hustle data tables
ALTER TABLE NBA_PROCESSED_2024_25.HUSTLE_PROCESSED_2024_25
ADD CONSTRAINT PK_HUSTLE PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.HUSTLE_PROCESSED_2024_25
ADD CONSTRAINT FK_HUSTLE_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.HUSTLE_PROCESSED_2024_25
ADD CONSTRAINT FK_HUSTLE_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for playertrack data tables
ALTER TABLE NBA_PROCESSED_2024_25.PLAYERTRACK_PROCESSED_2024_25
ADD CONSTRAINT PK_PLAYERTRACK PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.PLAYERTRACK_PROCESSED_2024_25
ADD CONSTRAINT FK_PT_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.PLAYERTRACK_PROCESSED_2024_25
ADD CONSTRAINT FK_PT_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for scoring data tables
ALTER TABLE NBA_PROCESSED_2024_25.SCORING_PROCESSED_2024_25
ADD CONSTRAINT PK_SCORING PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.SCORING_PROCESSED_2024_25
ADD CONSTRAINT FK_SCORING_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.SCORING_PROCESSED_2024_25
ADD CONSTRAINT FK_SCORING_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for traditional data tables
ALTER TABLE NBA_PROCESSED_2024_25.TRADITIONAL_PROCESSED_2024_25
ADD CONSTRAINT PK_TRADITIONAL PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.TRADITIONAL_PROCESSED_2024_25
ADD CONSTRAINT FK_TRAD_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.TRADITIONAL_PROCESSED_2024_25
ADD CONSTRAINT FK_TRAD_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for usage data tables
ALTER TABLE NBA_PROCESSED_2024_25.USAGE_PROCESSED_2024_25
ADD CONSTRAINT PK_USAGE PRIMARY KEY (GAME_ID, PLAYER_ID);

ALTER TABLE NBA_PROCESSED_2024_25.USAGE_PROCESSED_2024_25
ADD CONSTRAINT FK_USG_PLAYER FOREIGN KEY (PLAYER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

ALTER TABLE NBA_PROCESSED_2024_25.USAGE_PROCESSED_2024_25
ADD CONSTRAINT FK_USG_TEAM FOREIGN KEY (TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

-- Adding keys for schedule data tables
ALTER TABLE NBA_PROCESSED_2024_25.SCHEDULE_PROCESSED_2024_25
ADD CONSTRAINT PK_SCHEDULE PRIMARY KEY (GAME_ID);

ALTER TABLE NBA_PROCESSED_2024_25.SCHEDULE_PROCESSED_2024_25
ADD CONSTRAINT FK_SCHEDULE_HOME_TEAM FOREIGN KEY (HOME_TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

ALTER TABLE NBA_PROCESSED_2024_25.SCHEDULE_PROCESSED_2024_25
ADD CONSTRAINT FK_SCHEDULE_AWAY_TEAM FOREIGN KEY (AWAY_TEAM_ID)
REFERENCES NBA_PROCESSED_2024_25.TEAMS_PROCESSED_2024_25 (TEAM_ID);

ALTER TABLE NBA_PROCESSED_2024_25.SCHEDULE_PROCESSED_2024_25
ADD CONSTRAINT FK_SCHEDULE_POINTS_LEADER FOREIGN KEY (POINTS_LEADER_ID)
REFERENCES NBA_PROCESSED_2024_25.PLAYERS_PROCESSED_2024_25 (PERSON_ID);

SHOW PRIMARY KEYS;
